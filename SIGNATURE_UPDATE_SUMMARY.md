# ğŸ”„ äº‹ä»¶ç­¾åæ›´æ–°æ€»ç»“

## ğŸ“… æ›´æ–°æ—¶é—´
2024å¹´11æœˆ24æ—¥

---

## âœ… æ›´æ–°å†…å®¹

### äº‹ä»¶ç­¾åä¿®æ­£

æ ¹æ®å®é™…æ•°æ®æ›´æ–°äº† PancakeSwap V2 å’Œ V3 çš„äº‹ä»¶ç­¾åã€‚

### PancakeSwap V2 äº‹ä»¶ç­¾åï¼ˆå·²ä¿®æ­£ï¼‰

| äº‹ä»¶ | æ—§ç­¾åï¼ˆé”™è¯¯ï¼‰ | æ–°ç­¾åï¼ˆæ­£ç¡®ï¼‰ |
|------|---------------|---------------|
| Swap | `0xc42079f9...` | âœ… `0xd78ad95f...` |
| Mint | âœ… `0x4c209b5f...` | âœ… `0x4c209b5f...` (æ— å˜åŒ–) |
| Burn | âœ… `0xdccd412f...` | âœ… `0xdccd412f...` (æ— å˜åŒ–) |
| Sync | âœ… `0x1c411e9a...` | âœ… `0x1c411e9a...` (æ— å˜åŒ–) |

### PancakeSwap V3 äº‹ä»¶ç­¾åï¼ˆå·²ä¿®æ­£ï¼‰

| äº‹ä»¶ | æ—§ç­¾åï¼ˆé”™è¯¯ï¼‰ | æ–°ç­¾åï¼ˆæ­£ç¡®ï¼‰ |
|------|---------------|---------------|
| Swap | `0xd78ad95f...` | âœ… `0x19b47279...` |
| Mint | âœ… `0x7a53080b...` | âœ… `0x7a53080b...` (æ— å˜åŒ–) |
| Burn | âœ… `0x0c396cd9...` | âœ… `0x0c396cd9...` (æ— å˜åŒ–) |

---

## ğŸ“ å®Œæ•´ç­¾ååˆ—è¡¨

### V2 å®Œæ•´ç­¾å

```javascript
const V2_SIGNATURES = {
  SWAP: '0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822',
  MINT: '0x4c209b5fc8ad50758f13e2e1088ba56a560dff690a1c6fef26394f4c03821c4f',
  BURN: '0xdccd412f0b1252819cb1fd330b93224ca42612892bb3f4f789976e6d81936496',
  SYNC: '0x1c411e9a96e071241c2f21f7726b17ae89e3cab4c78be50e062b03a9fffbbad1',
};
```

### V3 å®Œæ•´ç­¾å

```javascript
const V3_SIGNATURES = {
  SWAP: '0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83',
  MINT: '0x7a53080ba414158be7ec69b987b5fb7d07dee101fe85488f0853ae16239d0bde',
  BURN: '0x0c396cd989a39f4459b5fa1aed6a9a8dcdbc45908acfd67e028cd568da98982c',
};
```

---

## ğŸ”§ æ›´æ–°çš„æ–‡ä»¶

### æ ¸å¿ƒæ–‡ä»¶ (2ä¸ª)

1. âœ… **src/monitor/streams/eventProcessor.js**
   - æ›´æ–° EVENT_SIGNATURES å¸¸é‡
   - V2 å’Œ V3 ç­¾åå…¨éƒ¨ä¿®æ­£

2. âœ… **src/monitor/streams/streamManager.js**
   - æ›´æ–° EVENT_TOPICS æ•°ç»„
   - Stream é…ç½®ä½¿ç”¨æ­£ç¡®çš„ç­¾å

### QuickNode è¿‡æ»¤å™¨ (5ä¸ª)

3. âœ… **quicknode-stream-filter.js**
   - V2 è¿‡æ»¤å™¨
   - æ·»åŠ ç‰ˆæœ¬æ³¨é‡Š

4. âœ… **quicknode-stream-filter-optimized.js**
   - V2 ä¼˜åŒ–ç‰ˆè¿‡æ»¤å™¨
   - æ·»åŠ ç‰ˆæœ¬æ³¨é‡Š

5. âœ… **quicknode-stream-filter-with-price.js**
   - V2 å¸¦ä»·æ ¼è®¡ç®—è¿‡æ»¤å™¨
   - æ·»åŠ ç‰ˆæœ¬æ³¨é‡Š

6. âœ… **quicknode-stream-filter-v3.js** (æ–°å¢)
   - V3 ä¸“ç”¨è¿‡æ»¤å™¨
   - ä¸åŒ…å« Sync äº‹ä»¶

7. âœ… **quicknode-stream-filter-v2-and-v3.js** (æ–°å¢)
   - ç»Ÿä¸€è¿‡æ»¤å™¨ï¼ŒåŒæ—¶æ”¯æŒ V2 å’Œ V3
   - è‡ªåŠ¨è¯†åˆ«äº‹ä»¶ç‰ˆæœ¬

### æµ‹è¯•å’Œæ–‡æ¡£ (4ä¸ª)

8. âœ… **test-webhook-data.js**
   - æ›´æ–°ç‰ˆæœ¬è¯†åˆ«å‡½æ•°
   - ä¿®æ­£ç­¾åå¯¹ç…§è¡¨

9. âœ… **WEBHOOK_DATA_FORMAT.md**
   - æ›´æ–°äº‹ä»¶ç­¾åå¯¹ç…§è¡¨
   - ä¿®æ­£ä»£ç ç¤ºä¾‹

10. âœ… **EVENT_SIGNATURES.md** (æ–°å¢)
    - å®Œæ•´çš„äº‹ä»¶ç­¾åå‚è€ƒæ–‡æ¡£
    - åŒ…å«äº‹ä»¶ç»“æ„å’Œä»£ç ç¤ºä¾‹

11. âœ… **SIGNATURE_UPDATE_SUMMARY.md** (æœ¬æ–‡æ¡£)
    - æ›´æ–°æ€»ç»“

---

## ğŸ¯ å½±å“åˆ†æ

### å·²æœ‰æ•°æ®

å¦‚æœæ‚¨ä¹‹å‰è¿è¡Œè¿‡ç³»ç»Ÿå¹¶æ”¶é›†äº†æ•°æ®ï¼š

- âœ… **V2 Mint/Burn/Sync**: ä¸å—å½±å“ï¼Œç­¾åæœªå˜åŒ–
- âš ï¸ **V2 Swap**: å¯èƒ½è¢«é”™è¯¯è¯†åˆ«
- âš ï¸ **V3 äº‹ä»¶**: å¯èƒ½è¢«é”™è¯¯è¯†åˆ«æˆ–é—æ¼

### è§£å†³æ–¹æ¡ˆ

å¦‚æœéœ€è¦é‡æ–°å¤„ç†å†å²æ•°æ®ï¼š

```bash
# 1. å¤‡ä»½æ•°æ®åº“
pg_dump lp_monitor > lp_monitor_backup.sql

# 2. æ¸…ç©ºç›¸å…³è¡¨ï¼ˆå¯é€‰ï¼‰
psql lp_monitor -c "TRUNCATE transactions, liquidity_events CASCADE;"

# 3. é‡æ–°å¯åŠ¨ç›‘æ§
npm run monitor:streams
```

---

## âœ… éªŒè¯æ›´æ–°

### 1. æ£€æŸ¥ä»£ç ä¸­çš„ç­¾å

```bash
# æ£€æŸ¥ eventProcessor.js
grep -n "0xd78ad95f" src/monitor/streams/eventProcessor.js
grep -n "0x19b47279" src/monitor/streams/eventProcessor.js

# åº”è¯¥çœ‹åˆ°:
# V2_SWAP: '0xd78ad95f...'
# V3_SWAP: '0x19b47279...'
```

### 2. æµ‹è¯•äº‹ä»¶è¯†åˆ«

```bash
# å¯åŠ¨ç›‘æ§ç³»ç»Ÿ
npm run monitor:streams

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯æµ‹è¯•
node test-webhook-data.js
```

æŸ¥çœ‹æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°æ­£ç¡®çš„ç‰ˆæœ¬è¯†åˆ«ï¼š

```
äº‹ä»¶ç­¾ååˆ†æ:
  swap:
    0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822 (PancakeSwap V2)
  sync:
    0x1c411e9a96e071241c2f21f7726b17ae89e3cab4c78be50e062b03a9fffbbad1 (PancakeSwap V2)
```

### 3. éªŒè¯å®é™…æ•°æ®å¤„ç†

å‘é€å®é™…çš„ webhook æ•°æ®ï¼ˆåŒ…å« V2 Swap ç­¾å `0xd78ad95f...`ï¼‰ï¼š

```bash
node test-webhook-data.js
```

åº”è¯¥çœ‹åˆ°ï¼š

```
âœ… Webhook å¤„ç†æˆåŠŸ!
   å¤„ç†çš„äº‹ä»¶: 2 ä¸ª swap, 2 ä¸ª sync
```

---

## ğŸ“Š ç­¾åå¯¹æ¯”è¡¨

| ç‰ˆæœ¬ | äº‹ä»¶ | ç­¾å (å‰8ä½) | ç­¾å (å®Œæ•´) |
|------|------|-------------|------------|
| V2 | Swap | `0xd78ad95f` | `0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822` |
| V2 | Mint | `0x4c209b5f` | `0x4c209b5fc8ad50758f13e2e1088ba56a560dff690a1c6fef26394f4c03821c4f` |
| V2 | Burn | `0xdccd412f` | `0xdccd412f0b1252819cb1fd330b93224ca42612892bb3f4f789976e6d81936496` |
| V2 | Sync | `0x1c411e9a` | `0x1c411e9a96e071241c2f21f7726b17ae89e3cab4c78be50e062b03a9fffbbad1` |
| V3 | Swap | `0x19b47279` | `0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83` |
| V3 | Mint | `0x7a53080b` | `0x7a53080ba414158be7ec69b987b5fb7d07dee101fe85488f0853ae16239d0bde` |
| V3 | Burn | `0x0c396cd9` | `0x0c396cd989a39f4459b5fa1aed6a9a8dcdbc45908acfd67e028cd568da98982c` |

---

## ğŸš€ ä¸‹ä¸€æ­¥

### ç«‹å³è¡ŒåŠ¨

1. âœ… **ä»£ç å·²æ›´æ–°** - æ‰€æœ‰æ–‡ä»¶å·²æ›´æ–°ä¸ºæ­£ç¡®çš„ç­¾å
2. ğŸ”„ **é‡å¯ç³»ç»Ÿ** - é‡å¯ç›‘æ§ç³»ç»Ÿä»¥åº”ç”¨æ›´æ–°
3. âœ… **æµ‹è¯•éªŒè¯** - è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯

### å¯é€‰æ“ä½œ

- ğŸ“– æŸ¥çœ‹ [EVENT_SIGNATURES.md](./EVENT_SIGNATURES.md) äº†è§£è¯¦ç»†çš„ç­¾åä¿¡æ¯
- ğŸ”§ æ›´æ–° QuickNode è¿‡æ»¤å™¨ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
- ğŸ—„ï¸ é‡æ–°å¤„ç†å†å²æ•°æ®ï¼ˆå¦‚æœéœ€è¦ï¼‰

---

## ğŸ’¡ å…³é”®è¦ç‚¹

1. **V2 Swap ç­¾åä¿®æ­£**
   - æ—§: `0xc42079f9...` (é”™è¯¯)
   - æ–°: `0xd78ad95f...` (æ­£ç¡®)

2. **V3 Swap ç­¾åä¿®æ­£**
   - æ—§: `0xd78ad95f...` (å®é™…æ˜¯ V2 çš„)
   - æ–°: `0x19b47279...` (æ­£ç¡®)

3. **ç³»ç»Ÿç°åœ¨æ”¯æŒ**
   - âœ… V2 å®Œæ•´æ”¯æŒ (Swap, Mint, Burn, Sync)
   - âœ… V3 å®Œæ•´æ”¯æŒ (Swap, Mint, Burn)
   - âœ… è‡ªåŠ¨ç‰ˆæœ¬è¯†åˆ«
   - âœ… æ··åˆç›‘æ§

4. **æ–°å¢å·¥å…·**
   - ä¸“ç”¨ V3 è¿‡æ»¤å™¨
   - ç»Ÿä¸€ V2+V3 è¿‡æ»¤å™¨
   - å®Œæ•´çš„ç­¾åå‚è€ƒæ–‡æ¡£

---

## ğŸ“ é—®é¢˜åé¦ˆ

å¦‚æœå‘ç°ä»»ä½•é—®é¢˜ï¼š

1. æ£€æŸ¥ç­¾åæ˜¯å¦æ­£ç¡®: `grep -r "0xd78ad95f" src/`
2. è¿è¡Œæµ‹è¯•: `node test-webhook-data.js`
3. æŸ¥çœ‹æ—¥å¿—: ç›‘æ§ç³»ç»Ÿè¿è¡Œæ—¶çš„è¯¦ç»†è¾“å‡º
4. å‚è€ƒæ–‡æ¡£: [EVENT_SIGNATURES.md](./EVENT_SIGNATURES.md)

---

**æ›´æ–°å®Œæˆï¼** ç³»ç»Ÿç°åœ¨ä½¿ç”¨æ­£ç¡®çš„ V2 å’Œ V3 äº‹ä»¶ç­¾åã€‚ğŸ‰

